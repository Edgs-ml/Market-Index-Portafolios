---
title: "Portafolio_in_R_Asesoria"
author: "Edgar Sigfrido Soto Aparicio"
date: "3/15/2022"
output: html_document
---
1. Librerias
```{r}
library(tidyverse)
library(quantmod)
library(PortfolioAnalytics)
library(fPortfolio)
library(PerformanceAnalytics)
library(readr)
library(psych)
```

2. Datos
```{r}
Activos <- c("AAPL", "AMZN", "FB", "NFLX", "MSFT")
getSymbols(Activos, from=as.Date("2020-01-01"), to=Sys.Date())
Aple <- Ad(AAPL)
MSC <- Ad(MSFT)
fb <- Ad(FB)
amz <- Ad(AMZN)
Netf <- Ad(NFLX)
PreciosAd <- merge.xts(Aple, amz, fb, Netf, MSC,
                       join = "inner") #interseccion, solo toma los dÃ­as donde todos                                            cotizan
Rend <- Return.calculate(PreciosAd, method = "log")[-1] #logN(x2/x1)
```
```{r}
chartSeries(Rend$AMZN.Adjusted)
chartSeries(PreciosAd)
cor.plot(Rend)
```

3. Portafolio
```{r}
Specs_Portfolio <- portfolio.spec(Activos) #genera una lista con los objetivos y restricciones
Specs_Portfolio <- add.constraint(Specs_Portfolio,type = "full_investment")
Specs_Portfolio <- add.constraint(Specs_Portfolio,type = "long_only")
Specs_Portfolio <- add.constraint(Specs_Portfolio, type = "5%")
Specs_Portfolio <- add.objective(Specs_Portfolio, type = "risk", name = "VaR")
Specs_Portfolio <- add.objective(Specs_Portfolio,type = "return",name = "mean") #optimizar a Sharp, en este casdo se debe quitar en "risk"
Specs_Portfolio
```

```{r}
Optimum_Portfolio <- optimize.portfolio(Rend, Specs_Portfolio) 
#en caso de que no converja, usar ", optimize_method = random"
```

```{r}
chart.Weights(Optimum_Portfolio)
```
```{r}
# nuevo objeto para los rendimientos del port
RendOptPort <- Return.portfolio(Rend,
                                extractWeights(Optimum_Portfolio))
plot(density(RendOptPort))

VaR(RendOptPort)*sqrt(1)*1000000

charts.PerformanceSummary(RendOptPort)
```

```{r}
table.AnnualizedReturns(RendOptPort) #por default esta anualizado
table.AnnualizedReturns(Rend)
```
expected Shortfall
```{r}
ES(RendOptPort)
#dentro de ese 1/20, cuanto vas a perder en promedio pasando el limite del VaR
```


optimizar el 





