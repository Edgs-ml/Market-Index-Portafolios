---
title: "Alternative_Investments"
author: "Miguel García Valaguez"
date: "3/30/2022"
output:
  html_document: default
  pdf_document: default
---

```{r}
library(quantmod)
library(PerformanceAnalytics)
library(tidyverse)
library(forecast)
library(tseries)
library(visdat)
library(psych)
library(ggplot2)
```


I. Realizar un portafolio tradicional en Bloomberg con las siguiente características: 50% EWW, 25% SPY, 25% EZU. Benchmark: ACWI.

Benchmark 
```{r}
#Benchmark: ACWI  
Benchmark <- ("ACWI")
getSymbols(Benchmark, from = "2011-12-31", to = Sys.Date())
Prices_benchmark <- ACWI [, 6]
Returns_benchmark <- CalculateReturns(prices = Prices_benchmark, method = "log") [-1] 
Benchmark_return <- Return.portfolio(R=Returns_benchmark, value = 100000, wealth.index = T)
Benchmark_value <- Benchmark_return * 1000000
```

Traditional portfolio
```{r}
Assets_traditional <- c("EWW", "^GSPC", "EZU")
getSymbols(Assets_traditional, from = "2011-12-31", to = Sys.Date()) 

EWW <- EWW [, 6]
GSPC <- GSPC [, 6]
EZU <- EZU [, 6]

Prices_traditional <- merge(EWW, GSPC, EZU)
vis_miss(Prices_traditional %>% as.data.frame())

Returns_traditional <- CalculateReturns(prices = Prices_traditional, method = "arithmetic") [-1] 
Returns_traditional_logarithmic <- CalculateReturns(prices = Prices_traditional, method = "log") [-1] 
Weights_traditional <- c(0.50, 0.25, 0.25)
Traditional_portfolio_return <- Return.portfolio(R=Returns_traditional, weights = Weights_traditional, value = 100000, wealth.index = T, contribution = T)
Traditional_portfolio_return_logarithmic <- Return.portfolio(R=Returns_traditional, weights = Weights_traditional, value = 100000, wealth.index = T, contribution = T) #for volatility calculation

```


II. Diluir el portafolio anterior al 85% e incluir 3 clases de activos alternativos cada una con un 5% de peso.

Alternative portfolio (15% of capital allocated on Commodities and Real Estate)  
```{r}
Assets_alternative <- c("EWW", "^GSPC", "VGK", "GLD", "ZW=F", "VNQ")
getSymbols(Assets_alternative, from = "2011-12-31", to = Sys.Date()) 

EWW <- EWW [, 6]
GSPC <- GSPC [, 6]
VGK <- VGK [, 6]
GLD <- GLD [, 6]
`ZW=F` <- `ZW=F` [, 6]
VNQ <- VNQ [, 6]

Prices_alternative <- merge(EWW, GSPC, VGK, GLD,`ZW=F`, VNQ)
vis_miss(Prices_alternative %>% as.data.frame())
Prices_alternative <- na.omit(Prices_alternative)

Returns_alternative <- CalculateReturns(prices = Prices_alternative, method = "arithmetic") [-1] 
Returns_alternative_logarithmic <- CalculateReturns(prices = Prices_alternative, method = "log") [-1] 
Weights_alternative <- c(0.50*0.85, 0.25*0.85, 0.25*0.85, 0.05, 0.05, 0.05)
Alternative_portfolio_return <- Return.portfolio(R=Returns_alternative, weights = Weights_alternative, value = 100000, wealth.index = T, contribution = T)
Alternative_portfolio_return_logarithmic <- Return.portfolio(R=Returns_alternative, weights = Weights_alternative, value = 100000, wealth.index = T, contribution = T) #for volatility calculation
Alternative_portfolio_value <- Alternative_portfolio_return * 1000000
```


III. A través de Port realizar el análisis de attribución por regiones y las características de riesgo del portafolio. Comprobar la hipótesis

Comparison
```{r}
#Returns
Traditional_portfolio_value <- Traditional_portfolio_return 
chart_Series(Traditional_portfolio_value [,1], name = "Historical Traditional Portfolio Value (in millions)")

Alternative_portfolio_value <- Alternative_portfolio_return 
chart_Series(Alternative_portfolio_value [,1], name = "Historical Alternative Portfolio Value (in millions)")

TradingDays_TP <- as.numeric(length(Traditional_portfolio_return [,1]))
TradingYears_TP <- TradingDays_TP / 252

EndingValue_TP <- as.numeric(tail(Traditional_portfolio_value [,1], n = 1))
BegginingValue_TP <- as.numeric(head(Traditional_portfolio_value [,1], n = 1))
CAGR_TP <- (EndingValue_TP/BegginingValue_TP)^(1/TradingYears_TP)-1

TradingDays_AP <- as.numeric(length(Alternative_portfolio_return [,1]))
TradingYears_AP <- TradingDays_AP / 252

EndingValue_AP <- as.numeric(tail(Alternative_portfolio_value [,1], n = 1))
BegginingValue_AP <- as.numeric(head(Alternative_portfolio_value [,1], n = 1))
CAGR_AP <- (EndingValue_AP/BegginingValue_AP)^(1/TradingYears_AP)-1

CAGRS <- merge(x = CAGR_TP, y = CAGR_AP)
CAGRS

chart_Series(Alternative_portfolio_return [,1] -1, name = "Alternative Portfolio Return against ACWI Index Return (Benchmark)")
add_TA((Benchmark_return-1), on = 1)

chart_Series(Traditional_portfolio_return [,1] -1, name = "Traditional Portfolio return against ACWI Index Return (Benchmark)")
add_TA((Benchmark_return-1), on = 1)

chart_Series(Traditional_portfolio_return [,1] -1, name = "Traditional Portfolio and Alternative Portfolio returns")
add_TA((Alternative_portfolio_return [,1] -1), on = 1)

#Standard Deviation
Traditional_portfolio_returns_logarithmic <- Return.portfolio(R=Returns_traditional_logarithmic, weights = Weights_traditional)
view(Traditional_portfolio_returns_logarithmic)
sd.annualized(Traditional_portfolio_returns_logarithmic)
STDEV.TP <- sd(Traditional_portfolio_returns_logarithmic)*sqrt(252)

Alternative_portfolio_returns_logarithmic <- Return.portfolio(R=Returns_alternative_logarithmic, weights = Weights_alternative)
view(Alternative_portfolio_returns_logarithmic)
sd.annualized(Alternative_portfolio_returns_logarithmic)
STDEV.AP <- sd(Alternative_portfolio_returns_logarithmic)*sqrt(252)

STDEVs <- as.data.frame(merge(STDEV.TP, STDEV.AP)) 
STDEVs

#Sharpe ratio
Risk_free_rate = 0.0242 #annualized rate of 10 year treasury bond at time zero of portfolio's life  
RFR = Risk_free_rate
SharpeTP <- (CAGR_TP - RFR)/ STDEV.TP
SharpeAP <- (CAGR_AP - RFR)/STDEV.AP

#Correlation matrix 
Corr_A <- corPlot(Returns_alternative)
#Average Correlation for Alternative Investments is of 0.2750
Corr_T <- corPlot(Returns_traditional)
#Average Correlation for Traditional Investments group is of 0.7433 while of 0.2750 for the one of Alternative Investments, hence reducing correlation in 63% 
```


IV. Replicar el rendimiento del portafolio y sacar una serie de correlaciones diarias con una ventana de tiempo de 1 año con la serie de rendimientos de los activos alternativos que se incluyeron. 

Assets for back end use
```{r}
Assets.global <- c("EWW", "^GSPC", "VGK", "GLD", "ZW=F", "VNQ", "ACWI")
getSymbols(Assets.global, from = "2010-12-31", to = Sys.Date()) 

EWW <- (EWW [, 6])
GSPC <- GSPC [, 6]
VGK <- VGK [, 6]
GLD <- GLD [, 6]
`ZW=F` <- `ZW=F` [, 6]
VNQ <- VNQ [, 6]
ACWI <- ACWI [, 6]

as.data.frame(`ZW=F`) %>% vis_miss()

Prices.global <- na.omit(merge(EWW, GSPC, VGK, GLD,`ZW=F`, VNQ, ACWI))
Returns.global <- CalculateReturns(prices = Prices.global, method = "arithmetic") [-1] 
head(Returns.global, n = 1)
```

Gold correlation with All Countries World Index as of April 1st (starting 2012)
```{r}
chartSeries(Benchmark_return-1)
```

```{r}
Gold_correlation <- rollapply(data = Returns.global, 
                              width = 253, 
                              function(x) cor(x[,4], x[,7]), 
                              by.column = F)
chartSeries(Gold_correlation)

#Average correlation 
mean(na.omit(Gold_correlation))
```

Wheat correlation with All Countries World Index as of April 1st (starting 2017)
```{r}
Wheat_correlation <- rollapply(data = Returns.global, width = 252, function(x) cor(x[,5], x[,7]), by.column = F)
chartSeries(Wheat_correlation)

#Average correlation 
mean(na.omit(Wheat_correlation))
```
agregar columna de rendimientos del portafolio tradicional
```{r}
Returns.global <- merge(Returns.global, ))
```





All of the above graphs are correlations of Alternative Investments with the referred Benchmark Index, however, we will also be calculating the correlations for Traditional Investments for demonstrational purposes  

VNQ Index correlation with All Countries World Index as of April 1st (starting 2017)
```{r}
VNQ_correlation <- rollapply(data = Returns.global, width = 252, function(x) cor(x[,1], x[,7]), by.column = F)
chartSeries(VNQ_correlation)

#Average correlation 
mean(na.omit(VNQ_correlation))
```

Mexican Market Index correlation with All Countries World Index as of April 1st (starting 2017)
```{r}
EWW_correlation <- rollapply(data = Returns.global, width = 252, function(x) cor(x[,2], x[,7]), by.column = F)
chartSeries(EWW_correlation)

#Average correlation 
mean(na.omit(EWW_correlation))
```

American Market Index correlation with All Countries World Index as of April 1st (starting 2017)
```{r}
GSPC_correlation <- rollapply(data = Returns.global, width = 252, function(x) cor(x[,3], x[,7]), by.column = F)
chartSeries(GSPC_correlation)

#Average correlation 
mean(na.omit(GSPC_correlation))
```

European Market Index correlation with All Countries World Index as of April 1st (starting 2017)
```{r}
VGK_correlation <- rollapply(data = Returns.global, width = 252, function(x) cor(x[,4], x[,7]), by.column = F)
chartSeries(VGK_correlation)

#Average correlation 
mean(na.omit(VGK_correlation))
```

V. Concluir en que momentos la correlación aumenta y disminuye apoyándose de la gráfica resultante 

Es dfícil determinar una relación de comportamiento de la correlación entre el oro y el mercado accionario, simplemente se tiene que esta correlación es cercana a cero como se muestra en el promedio de las correlaciones diarias (0.0527). Lo que sí se puede observar periodicamente, es una correlación negativa bastante fuerte en periodos de rendimientos negativos (sobre todos los más acelerados) para los mercados.
Si tomamos como referencia la gráficas del ACWI y la de correlación Oro con ACWI, se logra ver el efecto previamente mencionado. Esto ocurre en periodos como Enero 2015, donde la correlación es incluso negativa durante el tiempo más crítico en donde el precio del ACWI seguía bajando.  En Octubre de 2018 se vuelve apreciar este efecto, en donde la correlación va a la baja de 0.2 a -0.2 en tan solo un año, teniendo correlaciones negativas por un semestre entero. Es interesante lo que ocurre en la pandemia (marzo 2021) porque la correlación había sido negativa, pero al caerse todos los mercados a intercidumbres, esta tuvo un cambio repentino que llevo la correlación de -0.3 a 0.1 en cuestión de semanas, para después llegar hasta 0.32 derivado del rebote de los precios que hubo en medida que los inversionistas tenían más información del panorama derivado del COVID-19

VI. Realizar un paper con los resultados desde la hipótesis hasta la secuencia de pasos utilizados  

